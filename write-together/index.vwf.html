<link rel="stylesheet" href="css/bootstrap/bootstrap.css"></link>
<link rel="stylesheet" href="css/application.css"></link>

<script src="js/bootstrap.js" type="text/javascript"></script>

<script type="text/javascript">
  function setContentOrTitle(nodeId, propertyName, propertyValue) {
    var editorNodeId = vwf_view.kernel.find('', '/editor');

    if ( nodeId == editorNodeId[0] ) {
      switch ( propertyName ) {
        case "content":
          $("#doc-content").val(propertyValue);
          break;
        case "title":
          $("#doc-title").val(propertyValue);
          break;
        case "savename":
          $("#doc-savename").text(propertyValue);
          break;
      }
    }
  }

  $(function(){
    // Horrible hack to set the page to be white
    $('html').css('backgroundColor', '#f1f1f1');
    $('.full-screen').parent().css('backgroundColor', '#f1f1f1');

    vwf_view.satProperty = function (nodeId, propertyName, propertyValue) {
      console.log("Another changed content to: " + propertyValue);
      setContentOrTitle(nodeId, propertyName, propertyValue);
    }

    vwf_view.gotProperty = function (nodeId, propertyName, propertyValue) {
      console.log("Got property " + propertyName + "  with value: " + propertyValue);
      setContentOrTitle(nodeId, propertyName, propertyValue);
    }

    vwf_view.kernel.getProperty(vwf_view.kernel.find('', '/editor'), 'content');
    vwf_view.kernel.getProperty(vwf_view.kernel.find('', '/editor'), 'title');
    vwf_view.kernel.getProperty(vwf_view.kernel.find('', '/editor'), 'savename');

    $('#doc-content').on('input propertychange', function() {
      console.log("I changed content to: " + $(this).val());
      var editorNodeId = vwf_view.kernel.find('', '/editor');
      vwf_view.kernel.setProperty( editorNodeId[0], "content", $(this).val());
    });

    $('#doc-title').on('input propertychange', function() {
      console.log("I changed title to: " + $(this).val());
      var editorNodeId = vwf_view.kernel.find('', '/editor');
      vwf_view.kernel.setProperty( editorNodeId[0], "title", $(this).val());
    });

    $('#doc-save').click(function() {
      console.log("I saved the doc");
      var saveName = $("#doc-savename").text();

      // Show and hide the list user list in order to kick off the dynamic build of the save / load controls
      $.fx.off = true; // Turn off FX so we don't get any animations
      $('#userlist').click();
      $('#x').click();
      $.fx.on = false; // Turn back on FX

      // Stuff the filename in the box and force a click to submit the save
      $('#fileName').val(saveName);
      $('#save').click();
    });
  });
</script>

<div id="wrap" class="full-screen">
  <div id="title-row" class="row-fluid">
    <div class="span8">
      <a href="/write-together/list.html" class="close" data-toggle="tooltip" title="Return to Document List">&times;</a>
      <input id="doc-title" type="text" placeholder="Document title">
      <button id="doc-save" class="btn btn-primary">Save</button>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span8">
      <textarea id="doc-content" class="write-together-editor" rows="10">Yo mama</textarea>
    </div>
    <div class="span4 collaborators">
      <h4 class="collaborator-title">Collaborators</h2>
      <ul id="collaborator-list" class="unstyled">
        <li>
          Jess Martin
        </li>
        <li>
          Eric Burns
        </li>
      </ul>
      <small id="save-id">SAVENAME: <span id="doc-savename">5678</span></small>
    </div>
  </div>
</div>
