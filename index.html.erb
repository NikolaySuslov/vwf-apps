<html>
  <head>
    <title>VWF Demos</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <script src="jquery-1.7.1.js"></script>
    <script type='text/javascript'>
      function showInfo(app)
      {
        $('.overlay').css('visibility', 'visible');
        $('.overlay').html($('#'+ app + '-content').html());
      }
      function closeInfo()
      {
        $('.overlay').css('visibility', 'hidden');
      }
    </script>
    <script>

      setInterval( function() {

        jQuery( "div.content" ).each( function() {

          var applicationHTML = jQuery( this ).children( ".app-title" ).attr( "id" );
          var instances$ = jQuery( this ).children( ".instances" );
          var match;

          jQuery.getJSON( applicationHTML + "/admin/instances", function( data ) {
            instances$.empty();
            instances$.html("<p><b>Instances</b></p>");
            jQuery.each( data, function( key, value ) {
              if ( match = key.match( RegExp( "/([^/]*)$" ) ) ) { // assignment is intentional
                var instanceHTML = htmlEscape( match[1] );
                var size = Object.size(value.clients); 
                instances$.append( "<a href='" + applicationHTML + "/" + instanceHTML + "'>" + instanceHTML + " (" + size + ")" + "</a><br />" );
              }
            } );
          } );
          
        } );

      }, 5000 );

      // From http://stackoverflow.com/a/7124052

      function htmlEscape( string ) {
        return String( string ).
          replace( /&/g, "&amp;" ).
          replace( /"/g, "&quot;" ).
          replace( /'/g, "&#39;" ).
          replace( /</g, "&lt;" ).
          replace( />/g, "&gt;" );
      }

      Object.size = function(obj) { 
        var size = 0, key; 
        for (key in obj) { 
          if (obj.hasOwnProperty(key)) size++; 
        } 
        return size; 
      }; 

    </script>
  </head>
  <body>
    <div class="header">
      <div class="title">Virtual World Framework Demos</div>
    </div>

    <div>
<% while applications.any? do %>
      <div class="row">
<%   3.times do %>
<%     if applications.any? %>
<%       application, image, name = *applications.shift %>
        <!-- <%= name %> -->
        <div class="example">
          <a href="<%= application %>">
            <p><%= name %></p>
            <img src="<%= image %>" alt="<%= name %>" />
          </a>

          <!-- Info Button -->
          <div style="position:relative"><img style="position:absolute;right:2px;bottom:-12px" src="info.png" alt="i" onclick="showInfo('<%= name %>')" /></div>

          <!-- Content for Overlay -->
          <div id='<%= name %>-content' class='content'>
            <p class="exit-button"><img src="exit.png" alt="x" onclick="closeInfo()"/></p>
            <span class="app-title" id="<%= name %>"><b><%= name %></b></span>
            <hr>
            <div class="description">
              <p><b>Description</b></p>
              <p><%= name %></p>
            </div>
            <div class='instances'>
              <p><b>Instances</b></p>
            </div>

          </div>
          <!-- End Overlay Content -->
        </div>
        <!-- END <%= name %> -->
<%     end %>
<%   end %>
      </div>
<% end %>
    </div>

    <!-- Overlay div to display additional information -->
    <div style="position:absolute;top:30%;width:99%;height:99%;pointer-events:none">
      <div class="overlay">
      </div>
    </div>
  </body>
</html>