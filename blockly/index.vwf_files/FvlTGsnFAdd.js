/*!CK:1004542905!*//*1394506815,178162485*/

if (self.CavalryLogger) { CavalryLogger.start_js(["NR1Mw"]); }

__d("PaymentsFlowsUIConstants",[],function(a,b,c,d,e,f){var g={ADD_CREDITS_BUTTON:'add_credits',BANK_POPUP_BLOCK_MESSAGE:'popup_message',SECURITY_VERI_TEXT:'password_popup',SECURITY_VERI_FAILED_TEXT:'password_failed',BANK_PRICEPOINTS:'payment_pricepoints',ITEM_ID:'fbpayments_item',ITEM_PRICE_ID:'fbpayments_item_price',MOBILE_DROPDOWN_CONTAINER:'mobile_dropdown_container',MOBILE_INPUT_CONTAINER:'mobile_input_container',BOOST_PRICE:'boost_price',BOOST_BUTTON:'boost',SYNC_BUTTON:'sync_card',BUY_BUTTON:'buy',IFRAME_CHANGE_PM_LINK:'iframe_change_pm_link'};e.exports=g;});
__d("NewCreditCardInline",["AsyncRequest","Banzai","CSS","Form","PaymentsFlowsUIConstants","ge","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={endpoint:'/ajax/payment/token_proxy.php?tpe=/ajax/payments/credit_card/',cc_form:null,data_form:null,waterfall_data:null,test_mode:null,initSubmit:function(o,p,q){this.cc_form=o;this.data_form=p;this.context_id=q;},onSubmit:function(){if(!this.cc_form){this.completePayment(1);return false;}this.cc_form.onSubmit();var o=j.serialize(this.data_form);if(!this.cc_form.validate()){a.PaymentsFlows.enableButton(k.ADD_CREDITS_BUTTON);return false;}this.startLoading();var p=new g().setData(o).setHandler(this.requestHandler.bind(this)).setTransportErrorHandler(this.transportErrorHandler.bind(this.cc_form,this)).setURI(this.endpoint).setRelativeTo(this.data_form);p.send();},requestHandler:function(o){var p,q=o.getPayload();if(q.has_errors){this.stopLoading();return false;}p=q.cc_id;this.completePayment(p);},completePayment:function(o){var p={success:true,cc_id:o,credit_card_added:true,context_id:this.context_id};a.PaymentsFlows.processPopup(p);},transportErrorHandler:function(o,p){this.stopLoading();p.payload={error_codes:{1383001:"There was a problem with your request. Please try again."}};p.payload.button_to_enable_on_error=k.ADD_CREDITS_BUTTON;o.errorHandler(p);},startLoading:function(){if(l('loading_payment'))i.show(l('loading_payment'));if(l('inline_cc_body'))i.hide(l('inline_cc_body'));},stopLoading:function(){if(l('loading_payment'))i.hide(l('loading_payment'));if(l('inline_cc_body'))i.show(l('inline_cc_body'));a.PaymentsFlows.enableButton(k.ADD_CREDITS_BUTTON);},initWaterfallLog:function(o,p){this.waterfall_data=o;this.test_mode=p;},setWaterfallLog:function(){var o={step_id:'prompt_purchase_fullpage',data:this.waterfall_data,is_test:this.test_mode};h.post('payments_waterfall',o,h.VITAL);}};e.exports=n;});
__d("PaymentsFlowsBase",["Arbiter","AsyncRequest","Banzai","CSS","Dialog","DocRPC","DOM","NewCreditCardInline","PaymentsFlowsUIConstants","$","copyProperties","csx","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(u,v,w){this.context_id=u;this.orderId=v;this._clickLogs=[];this._hasCanceled=false;this.trackingID=w;g.subscribe('layer_hidden',this.onClose.bind(this));l.publish(this,'paymentFlowAPI');q(this,o);}q(t.prototype,{DIALOG_ENDPOINT:'/fbml/ajax/dialog/',ASYNC_ENDPOINT:'/ajax/flows/',oscifPrices:{},methodConfigs:{},itemUpdateNeeded:false,context_id:null,anySelectedMethod:{},useIconRendering:false,renderNewCCInline:false,renderAdsInlinePayment:false,cancelSurveyDialog:null,logActivity:function(u){i.post('payments',u,i.VITAL);},onClose:function(u,v){if(v.type=='Dialog'&&!this._hasCanceled){this.saveMethodActivityLog('cancel');this._hasCanceled=true;}},onPurchaseSubmit:function(u,v){this.disableButton(o.ADD_CREDITS_BUTTON);this.updateCouponStatus();if(!u)u=this.getPaymentMethod();this.logMethodSubmit(u);this.saveMethodActivityLog('submit',u);var w=this.methodConfigs[u];if(w&&w.open_popup){if(!v.add_num_credits)v.add_num_credits=this.getAddNumCredits();if(u=='new_cc'&&this.renderNewCCInline){n.onSubmit();}else this.openPopup(w,v);return false;}var x=this.getPricepointDropdown(u),y={};if(x)y.provider_add_num_credits=x.value;y.should_update_country=false;this.submitDialogRequest(y);return false;},updateCountryRefresh:function(u){this.submitDialogRequest({selected_country:u,should_update_country:true});},onUserClickCancel:function(){this.submitDialogRequest({cancel:true});if(this.cancelSurveyDialog)this.cancelSurveyDialog.show();this.closePopup(false);return false;},onDisclaimerSubmit:function(u){this.submitDialogRequest({decision:u});return false;},forceFlowStep:function(u,v){v=v?v:{};v.force_flow_step=u;this.submitDialogRequest(v);return false;},updatePricepoints:function(){var u=this.getFormData(),v=function(w){m.setContent(s(o.BANK_PRICEPOINTS),w.getPayload());};if(!u.currency)return;this.submitAsyncRequest({currency:u.currency,update_pricepoints:1},v);},updateItem:function(u){u=typeof u!=='undefined'?u:this.getPaymentMethod();var v=function(w){m.setContent(s(o.ITEM_ID),w.getPayload());};this.submitAsyncRequest({payment_method:u,amount:this.getAddNumCredits(),country_update:this.getCountryUpdate(u),update_item:1},v);},oscifUpdateMobileCountry:function(){var u=function(x){var y=x.getPayload();if(y){var z=y.item_update,aa=y.dropdowns_update,ba=y.mobile_input_update,ca=y.is_price_only?s(o.ITEM_PRICE_ID):s(o.ITEM_ID);ca&&m.setContent(ca,z);var da=s(o.MOBILE_DROPDOWN_CONTAINER);da&&m.replace(da,aa);var ea=s(o.MOBILE_INPUT_CONTAINER);ea&&m.replace(ea,ba);}},v=this.getPaymentMethod(),w=this.getCountryUpdate(v);this.submitAsyncRequest({payment_method:v,amount:this.getAddNumCredits(),country_update:w,update_item_and_dropdowns:1},u);},onUpdatePaymentMethod:function(u,v){this.anySelectedMethod[u]=1;for(var w in this.anySelectedMethod){var x=this.getDropdownContainer(w);x&&j.conditionShow(x,u==w);var y=s(o.MOBILE_INPUT_CONTAINER);y&&j.conditionShow(y,u=='mobile');var z=m.scry(document.body,"div._5179")[0];z&&j.conditionShow(z,u=='mobile');var aa=m.scry(document.body,"div._55wj")[0];if(aa){j.conditionShow(aa,u=='new_cc');if(u=='new_cc'){this.renderNewCCInline=true;n.setWaterfallLog();}}}var ba=m.scry(this.getContainer(),'.selected');if(ba.length>0)for(var ca=0;ca<ba.length;ca++)j.removeClass(ba[ca],'selected');if(v){this.itemUpdateNeeded&&this.updateItem(u);}else{var da=this.getContainer(),ea=m.scry(da,'.default_pricepoint'),fa=false;for(var ca=0;ca<ea.length;ca++)fa=fa||ea[ca].id.lastIndexOf(u)!=-1;ea=m.scry(da,'.local_cur_amt');for(var ga=0;ga<ea.length;ga++)j.conditionShow(ea[ga],fa);}this.logMethodClick(u);},saveMethodActivityLog:function(u,v){var w={e:'payment_method_behavior',act:u,act_m:v,tid:this.trackingID,logs:this._clickLogs};this.logActivity(w);this._clickLogs=[];},logMethodClick:function(u){var v={timestamp:Date.now(),method:u};this._clickLogs.push(v);},logMethodSubmit:function(u){var v={timestamp:Date.now(),method:u,action:'submit'};this._clickLogs.push(v);},logRevealFlowsClick:function(u){var v={method:u,action:'reveal_flows'};this._clickLogs.push(v);},setPaymentMethodConfig:function(u){this.methodConfigs=u;},setOscifPriceConfig:function(u){this.oscifPrices=u;},setItemUpdateNeeded:function(u){this.itemUpdateNeeded=u;},setUseIconRendering:function(u){this.useIconRendering=u;},updateCouponStatus:function(){if(!s('coupon_checkbox'))return;var u={context_id:this.context_id,var_name:'show_coupon_flow',var_value:document.getElementById('coupon_checkbox').checked};i.post('flow_context',u,i.VITAL);},updateCouponMessage:function(){if(document.getElementById('coupon_checkbox').checked){j.show('flows_message');}else j.hide('flows_message');},hideCouponCheckbox:function(){var u='coupon_checkbox_label';if(s(u))j.hide(u);var v='coupon_learn_more_link';if(s(v))j.show(v);},setPaymentMethod:function(u){this.paymentMethod=u;if(s('payment_method_input'))s('payment_method_input').value=u;if(s('payment_option_input'))s('payment_option_input').value=u;},getPaymentMethod:function(){if(this.paymentMethod){return this.paymentMethod;}else{var u=this.getFormData();if(u.payment_method){return u.payment_method;}else if(u.payment_option){return u.payment_option;}else{var v=m.scry(p('payment_options'),'input[type="radio"]'),w=null;for(var x=0;x<v.length;x++)if(v[x].checked){w=v[x].value;break;}return w;}}},getAddNumCredits:function(){var u=this.getFormData();if(u.add_num_credits)return u.add_num_credits;return this.getOscifAddNumCredits();},getOscifAddNumCredits:function(){var u=this.getPaymentMethod(),v=this.getPricepointDropdown(u);if(!v){return this.oscifPrices.price;}else return parseInt(v.value,10);},revealPurchaseItemPMSelection:function(){s('flows_body_content')&&j.show('flows_body_content');s('flows_default_button_message')&&j.hide('flows_default_button_message');s('country_test_area')&&j.show('country_test_area');},getCountryUpdate:function(u){var v=s(u+'_country_dropdown');if(v)v=v.value;return v;},getContainer:function(){return s('payment_body_and_buttons');},getPricepointDropdown:function(u){return s(u+'_dropdown');},getDropdownContainer:function(u){return s(u+'_dropdown_container');},revealFlows:function(u,v){if(v)this.logRevealFlowsClick(u);s('flows_content')&&j.show('flows_content');s('flows_show_more')&&j.hide('flows_show_more');if(this.useIconRendering&&u!='mobile')this.hideButton(o.ADD_CREDITS_BUTTON);this.submitAsyncRequest({change_payment_method:true});},showCountryDropdown:function(){s('country_test_message')&&j.hide('country_test_message');s('country_test_dropdown')&&j.show('country_test_dropdown');},submitAsyncRequest:function(u,v){u.context=this.getFormData().context;new h().setURI(this.ASYNC_ENDPOINT).setHandler(v).setData(u).send();},openPopup:function(u,v){},closePopup:function(u){},processPopup:function(u){},processIFrame:function(u){},getFormData:function(){},submitDialogRequest:function(u){},enableButton:function(u){},disableButton:function(u){},showButton:function(u){},hideButton:function(u){},changeButtonText:function(u,v){},showSecurityVeriFailed:function(){s(o.SECURITY_VERI_TEXT)&&j.hide(o.SECURITY_VERI_TEXT);s(o.SECURITY_VERI_FAILED_TEXT)&&j.show(o.SECURITY_VERI_FAILED_TEXT);},handleSelectingOtherAmount:function(){var u=p('select_amount'),v=p('other_amount');if(u.checked){v.readOnly=false;v.focus();}else v.value='';},OtherAmount:function(){var u=p('select_amount'),v=p('other_amount');u.checked=true;v.readOnly=false;},iFrameTimerId:0,iFrameTimeout:5000,checkPayThreshold:10,checkPayInterval:2000,checkPayCount:0,checkPaymentStatus:function(){var u=function(){s('checking_payment_status')&&j.show('checking_payment_status');var w=this.checkPayCount>=this.checkPayThreshold,x={force_async_notify:+w,payment_provider_completed:1,check_pay_count:this.checkPayCount};if(w){this.checkPayCount=0;this.submitDialogRequest(x,'checkPayment');}else this.submitAsyncRequest(x,v);}.bind(this),v=function(w){var x=w.getPayload();s('checking_payment_status')&&j.hide('checking_payment_status');this.checkPayCount++;if(x.awaiting_payment){s('payment_progress_bar')&&m.setContent(p('payment_progress_bar'),x.progress_bar);setTimeout(u,this.checkPayInterval);}else{this.checkPayCount=0;new k().setTitle(x.title).setBody(x.body).setButtons(x.buttons).setWideDialog(true).show();}}.bind(this);setTimeout(u,this.checkPayInterval);},iFrameInit:function(u){if(u){var v=function(){w.unsubscribe();clearTimeout(this.iFrameTimerId);}.bind(this),w=g.subscribe('Connect.Unsafe.PAYMENT_PROVIDER_INIT',v),x=function(){v();var y={payment_provider_error:1,payment_provider_ec:1,payment_provider_msg:'Provider timed out'};this.forceFlowStep('WalletFlow',y);}.bind(this);setTimeout(x,this.iFrameTimeout);}},_lockedForProviderProcessing:false,iFrameChangePaymentMethod:function(){if(this._lockedForProviderProcessing)return;this.submitDialogRequest({change_payment_method:1});},lockForProviderProcessing:function(){this._lockedForProviderProcessing=true;var u=s(o.IFRAME_CHANGE_PM_LINK);u&&j.addClass(u,'uiLinkSubtle');},unlockForProviderProcessing:function(){this._lockedForProviderProcessing=false;var u=s(o.IFRAME_CHANGE_PM_LINK);u&&j.removeClass(u,'uiLinkSubtle');}});e.exports=t;});
__d("PaymentsFlowsAsync",["AdsInlinePayment","Button","CSS","Dialog","DOM","Form","FullScreen","PaymentsFlowsBase","PaymentsFlowsUIConstants","URI","Vector","copyProperties","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){for(var t in n)if(n.hasOwnProperty(t))v[t]=n[t];var u=n===null?null:n.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=n;function v(){"use strict";if(n!==null)n.apply(this,arguments);}v.prototype.forceFlowStep=function(w,x){"use strict";this.closePopup();return u.forceFlowStep.call(this,w,x);};v.prototype._setupPopupOpenChecks=function(w,x){"use strict";this.popupTimerId=setInterval(function(){if(!w())this.onPopupClose(x);}.bind(this),this.pollingInterval);if(!w()){this.showBlockedPopupMessage();this.enableButton(x);}else this.hideBlockedPopupMessage();};v.prototype._showPopup=function(w,x){"use strict";var y=800,z=550,aa=1,ba=1,ca=1;if(x!=null)if(x.is_paypal_digital_goods_flow){y=420;z=550;aa=0;ba=0;ca=0;}else if(x.is_paypal){y=955;z=750;}else if(x.is_promotion){y=550;z=800;}var da=0,ea=0;if(window.screenLeft){da=window.screenLeft;ea=window.screenTop;}else if(window.screenX){da=window.screenX;ea=window.screenY;}var fa=q.getViewportDimensions().x,ga=q.getViewportDimensions().y;da=da+(fa-y)/2;ea=ea+(ga-z)/2;var ha='';if(!m.isFullScreen())ha='top='+ea+','+'left='+da+','+'width='+y+','+'height='+z+',';this.popup=window.open(w.toString(),'CreditsFlowPopupWindow','location=yes,'+ha+'resizable='+aa+','+'toolbar='+ba+','+'menubar='+ca+','+'scrollbars=yes',true);};v.prototype.openPopup=function(w,x){"use strict";var y,z;if(x.is_sync_flow){z=p("/giftcredits/index.php");z.setDomain(p.getRequestURI().getDomain());z.setProtocol('https');z.addQueryData(z.addQueryData({context_id:x.context_id}));z.addQueryData({is_redirect_secure:p.getRequestURI().isSecure()});y=o.SYNC_BUTTON;this.disableButton(y);}else{var aa=w.popup_url;z=p(aa);if(!w.use_payment_engine){z.addQueryData(x);z.addQueryData({use_payment_engine:w.use_payment_engine});}y=o.ADD_CREDITS_BUTTON;this.disableButton(y);}this._showPopup(z,w);this._setupPopupOpenChecks(function(){return this.popup&&(!this.popup.closed);}.bind(this),y);return false;};v.prototype.onPopupClose=function(w){"use strict";if(this.popupTimerId!==0){clearInterval(this.popupTimerId);this.popupTimerId=0;}this.enableButton(w);};v.prototype.closePopup=function(w){"use strict";this.onPopupClose(o.ADD_CREDITS_BUTTON);if(this.popup){this.popup.close();if(!this.popup.closed){var x=new p('/payments/message.php');if(!w)x.addQueryData('cancel',1);this.popup.location=x.toString();}this.popup=null;}};v.prototype.processGiftcardIFrame=function(w){"use strict";if(w.gc_result_code==="0"&&w.gc_fwd_url){window.goURI(w.gc_fwd_url);return false;}return true;};v.prototype.processIFrame=function(w){"use strict";if(!this.processGiftcardIFrame(w))return;if(this.renderAdsInlinePayment&&this.getPaymentMethod()=='new_direct_debit'){g.processDirectDebitPopup(w);return;}this.closePopup(!w.cancel);this.enableButton(o.ADD_CREDITS_BUTTON);if(!w.cancel){if(w.change_method){this.forceFlowStep('WalletFlow');}else this.submitDialogRequest(w);}else{if(w.cancel_dialog){this.submitDialogRequest({cancel:'cancel'});return false;}this.showSecurityVeriFailed();}};v.prototype.processPopup=function(w){"use strict";if(!w.cancel&&w.context_id!=this.context_id)return;this.processIFrame(w);};v.prototype.getFormData=function(){"use strict";var w=j.getCurrent();return w.getFormData();};v.prototype.submitDialogRequest=function(w){"use strict";var x=j.getCurrent(),y=x.getBody();l.createHiddenInputs(w,y);x._submitForm('POST',this.DIALOG_ENDPOINT);};v.prototype.getButtonElem=function(w){"use strict";var x=j.getCurrent();return x.getButtonElement(w);};v.prototype.enableButton=function(w){"use strict";var x=this.getButtonElem(w);x&&h.setEnabled(x,true);};v.prototype.disableButton=function(w){"use strict";var x=this.getButtonElem(w);x&&h.setEnabled(x,false);};v.prototype.showButton=function(w){"use strict";var x=this.getButtonElem(w);x&&i.show(k.find(x,'^.uiButton'));};v.prototype.hideButton=function(w){"use strict";var x=this.getButtonElem(w);x&&i.hide(k.find(x,'^.uiButton'));};v.prototype.changeButtonText=function(w,x){"use strict";var y=j.getCurrent(),z=y.getButtonElement(w);z&&h.setLabel(z,x);};v.prototype.showBlockedPopupMessage=function(){"use strict";var w=s(o.BANK_POPUP_BLOCK_MESSAGE);if(w)i.show(w);};v.prototype.hideBlockedPopupMessage=function(){"use strict";var w=s(o.BANK_POPUP_BLOCK_MESSAGE);if(w)i.hide(w);};r(v.prototype,{popup:null,pollingInterval:100,popupTimerId:0});e.exports=v;});
__d("GiftCredits",["Arbiter","AsyncRequest","Dialog","PaymentsFlowsAsync","Run","URI","XdArbiter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={dialog:null,callback:null,purchaseLock:false,purchaseLockExpiryThreshold:5000,purchaseLockTimeoutId:null,cancelSurveyDialog:null,promoAppId:null,getPurchaseCreditPrompt:function(p,q,r,s){n.main(p,null,null,null,r,null,null,null,'BuyCredits',{},s);},redeemGiftcard:function(p,q,r){var s=l(document.location).setPath('/giftcards').toString();n.main(p,null,null,s,null,null,null,null,q,{},r);},getPrompt:function(p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){n.main(p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la);},main:function(p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){if(n.isPurchaseLocked())return false;n.setPurchaseLock(true);var ma={_path:'pay',method:'pay',display:'async',app_id:p,receiver:q,api_key:v,credits_purchase:ca,action:x,next:s,dev_purchase_params:JSON.stringify(y),additional_params:JSON.stringify(z),order_info:JSON.stringify(r),product:aa,package_id:ba,request_id:da,sdk:ea,quantity:fa,quantity_min:ga,quantity_max:ha,test_currency:ia,pricepoint_id:ja,user:ka,user_hash:la},na=new h().setURI('/fbml/ajax/dialog/').setData(ma).setMethod('GET').setReadOnly(true).setStatusElement('commerce_get_more_loading');n.callback=t;n.dialog=new i().setAsync(na).setModal(true).setCancelHandler(n.onCancel).setCloseHandler(function(oa){n.setPurchaseLock(false);t(oa);}).show();},onCancel:function(p){var q=i.getCurrent();if(q&&!(q.getButtonElement(i.CANCEL)||p))return false;n.setPurchaseLock(false);if(n.callback){var r={error_code:1383010,error_message:'User canceled the order.'};n.callback({response:JSON.stringify(r)});}if(p)n.dialog.hide();if(n.cancelSurveyDialog){n.cancelSurveyDialog.show();}else if(n.promoAppId){var s=l('/payments/promotion/').setSubdomain('www').setQueryData({app_id:n.promoAppId,placement:'cancel_button',package_name:'zero_promo'});new j(0)._showPopup(s,{is_promotion:true});}},setCancelSurveyDialog:function(p){n.cancelSurveyDialog=p;},resetCancelSurveyDialog:function(){n.cancelSurveyDialog=null;},isPurchaseLocked:function(){return n.purchaseLock;},setPurchaseLock:function(p){n.purchaseLock=p;if(p){n.purchaseLockTimeoutId=setTimeout(function(){n.setPurchaseLock(false);},n.purchaseLockExpiryThreshold);}else clearTimeout(n.purchaseLockTimeoutId);return true;}};function o(p,q){var r=function(s){var t=l('?'+l(q.channel).getFragment()).getQueryData(),u=l(t.origin).getOrigin();t.response=s.response;m.send(t,null,u);};n.getPrompt(q.app_id,q.receiver,q.order_info,q.back_url,r,null,null,null,q.action,q.dev_purchase_params,q.additional_params,q.product,q.subscription_id,q.credits_purchase,q.request_id,q.sdk,q.quantity,q.quantity_min,q.quantity_max,q.test_currency,q.pricepoint_id);}k.onLoad(function(){g.subscribe('Connect.Unsafe.Pay.Prompt',o);});e.exports=n;});
__d("AdsInlinePayment",["AsyncRequest","Banzai","CSS","DOM","Event","Form","GiftCredits","PopupWindow","Style","URI","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=null,t=null,u=null,v=null,w=100,x=null,y=null,z=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=null,ga=null,ha=null,ia=null,ja={initNewCCOption:function(ka){ca=ka;},initPaypalOption:function(ka){x=ka;},initNewDirectDebitIFrame:function(ka,la,ma,na){y=ka;z=na;la.onload=function(){i.hide(ma);o.set(la,'left',0);};},initCouponCheckBox:function(ka,la){da=ka;i.conditionShow(la,da.checked);k.listen(da,'change',function(ma){i.conditionShow(la,da.checked);});},init:function(ka,la,ma){t=ka;s=la;ba=ma;},initWaterfallLog:function(ka,la){fa=ka;ea=la;},onPurchaseSubmit:function(ka,la,ma){ia=ka;ga=la;ha=ma;this._hideError();ia();var na=this._getPaymentMethod(),oa={};switch(na){case 'new_cc':ca.onSubmit();if(!ca.validate()){ha({type:'cc_form_validate_fail'});return;}oa=l.serialize(ba);new g().setURI('/ajax/payment/token_proxy.php?tpe=/ajax/payments/credit_card/').setData(oa).setHandler(this._processCreditCard.bind(this)).send();break;case 'new_direct_debit':var pa=this._getCountryCode();if(pa)q(aa,{new_direct_debit_country_dropdown:pa});q(oa,aa);new g('/ajax/payments/direct_debit/init.php').setData(oa).send();break;case 'paypal':var qa=new p('/payments/paypal_init.php').setProtocol('https').setSubdomain('secure').setQueryData(x).toString();this._openPaypalPopup(qa);break;}},_processCreditCard:function(ka){var la=ka.getPayload();if(la.has_errors){ha({type:'add_cc_fail'});return;}this._logStep('fullpage_payment_completed',la);q(la,{credit_card_added:1});this._setPrimaryFundingSource(la);},processPaypalPopup:function(ka){this._closePopup();if(ka.cancel){ha({type:'cancel_paypal'});return;}this._logStep('paypal_payment_completed',ka);this._setPrimaryFundingSource(ka);},processDirectDebitPopup:function(ka){this._closeDialog();if(ka.cancel){ha({type:'cancel_direct_debit'});return;}ka.dd_context_id=z;this._setPrimaryFundingSource(ka);},_showError:function(ka){var la=j.find(ba,'.'+"_56tj");j.insertBefore(la,ka);},_hideError:function(){ca&&ca.hideErrors();j.scry(ba,'.'+"_56tk").forEach(j.remove);},_getPaymentMethod:function(){var ka=j.scry(ba,'input[name="payment_method"]'),la=null;for(var ma=0;ma<ka.length;ma++)if(ka[ma].checked){la=ka[ma].value;break;}return la;},_getCountryCode:function(){var ka=j.scry(ba,'input[name="new_direct_debit_country_dropdown"]');if(ka.length>0)return ka[0].value;return null;},_shouldShowCouponDialog:function(){return !!da&&da.checked;},_openPaypalPopup:function(ka){u=n.open(ka,800,1000);this._setupPopupOpenCheck();},_setupPopupOpenCheck:function(){v=setInterval(function(){if(u&&u.closed){this._closePopup();ha({type:'close_paypal_popup'});}}.bind(this),w);},_closePopup:function(){if(v!==0){clearInterval(v);v=0;}if(u){u.close();u=null;}},_closeDialog:function(){if(y){y.hide();y=null;}},_setPrimaryFundingSource:function(ka){var la=function(ma){var na=ma.getPayload();if(na.has_errors){this._showError(na.error_msg);ha({type:'primary_funding_source_fail'});return;}if(this._shouldShowCouponDialog()){var oa=function(pa){ga(na);}.bind(this);m.getPrompt(s,null,{},null,oa,'admanager',null,null,'ads',{account_id:t,funding_id:na.funding_id,funding_type:na.funding_type,payment_method_type:this._getPaymentMethod(),shortcut_coupon_flow:true},{placement:'create_flow'});}else ga(na);}.bind(this);q(ka,{account_id:t,has_coupon:this._shouldShowCouponDialog()});new g('/ajax/ads/funding_source/set_primary').setData(ka).setHandler(la).send();},_logStep:function(ka,la){q(la,fa);var ma={step_id:ka,data:la,is_test:ea};h.post('payments_waterfall',ma,h.VITAL);}};a.AdsInlinePayment=ja;e.exports=ja;});
__d("legacy:giftcredits",["GiftCredits"],function(a,b,c,d){a.GiftCredits=b('GiftCredits');},3);
__d("CanvasResizer",["createArrayFrom","CSS","DOMEventListener","Vector"],function(a,b,c,d,e,f,g,h,i,j){var k;function l(){var n,o=document.documentElement;if(window.innerHeight){n=window.innerHeight;}else if(o&&o.clientHeight){n=o.clientHeight;}else n=document.body.clientHeight;for(var p=0;p<k.length;p++){var q=k[p];if(!h.hasClass(q,'noresize')){var r=j.getElementPosition(q,'document').y,s=n-r;q.style.height=s/(k.length-p)+'px';}}}i.add(window,'resize',l);var m={smartSizingFrameAdded:function(){k=[];var n=g(document.getElementsByTagName('iframe'));n.forEach(function(o){if(h.hasClass(o,'smart_sizing_iframe')&&!h.hasClass(o,'noresize')){h.removeClass(o,'canvas_iframe_util');k.push(o);}});l();}};e.exports=m;});